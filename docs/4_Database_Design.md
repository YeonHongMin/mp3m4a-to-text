# ğŸ—„ï¸ Database Design - ë°ì´í„°ë² ì´ìŠ¤ ì„¤ê³„
## MP3 to Text Converter

---

> **ì°¸ê³ **: ì´ í”„ë¡œì íŠ¸ëŠ” ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ì‚¬ìš©í•˜ì§€ ì•Šê³  íŒŒì¼ ì‹œìŠ¤í…œ ê¸°ë°˜ìœ¼ë¡œ ë™ì‘í•©ë‹ˆë‹¤.
> ë³¸ ë¬¸ì„œëŠ” íŒŒì¼ ì‹œìŠ¤í…œ êµ¬ì¡°ì™€ ë°ì´í„° í˜•ì‹ì„ ì •ì˜í•©ë‹ˆë‹¤.

---

## 1. íŒŒì¼ ì‹œìŠ¤í…œ êµ¬ì¡°

```
project_root/
â”œâ”€â”€ src/                          # ì†ŒìŠ¤ ì½”ë“œ
â”‚   â”œâ”€â”€ mp3_to_text.py           # í•µì‹¬ ë³€í™˜ ëª¨ë“ˆ + CLI
â”‚   â”œâ”€â”€ app_gui.py               # Gradio ì›¹ GUI (port 7860)
â”‚   â”œâ”€â”€ web_ui.py                # Flask ì›¹ UI (port 5001)
â”‚   â”œâ”€â”€ app_tkinter.py           # Tkinter ë„¤ì´í‹°ë¸Œ GUI
â”‚   â””â”€â”€ fix_hallucination.py     # í• ë£¨ì‹œë„¤ì´ì…˜ í›„ì²˜ë¦¬ ë„êµ¬
â”‚
â”œâ”€â”€ mp3/                          # ì˜¤ë””ì˜¤ ë° ê²°ê³¼ íŒŒì¼
â”‚   â”œâ”€â”€ *.mp3                    # ì…ë ¥ ì˜¤ë””ì˜¤ íŒŒì¼
â”‚   â”œâ”€â”€ *_full.md                # ì „ì²´ í…ìŠ¤íŠ¸ ì¶œë ¥
â”‚   â”œâ”€â”€ *_time.md                # ì‹œê°„ëŒ€ë³„ ì¶œë ¥
â”‚   â””â”€â”€ log/                     # ë³€í™˜ ë¡œê·¸
â”‚       â””â”€â”€ YYYY-MM-DD.md        # ì¼ìë³„ ë¡œê·¸
â”‚
â”œâ”€â”€ docs/                         # ë¬¸ì„œ
â”œâ”€â”€ convert_all.sh                # ì¼ê´„ ë³€í™˜ ìŠ¤í¬ë¦½íŠ¸
â”œâ”€â”€ requirements.txt              # ì˜ì¡´ì„±
â””â”€â”€ .venv/                        # ê°€ìƒí™˜ê²½ (gitignore)
```

---

## 2. ì¶œë ¥ íŒŒì¼ í˜•ì‹

### 2.1 ì „ì²´ í…ìŠ¤íŠ¸ íŒŒì¼ (_full.md)

```markdown
# ğŸ“ Audio Transcription - Full Text

> **íŒŒì¼**: `mp3/audio.mp3`  
> **ìƒíƒœ**: ë³€í™˜ ì™„ë£Œ

---

ì²« ë²ˆì§¸ ë¬¸ì¥ì…ë‹ˆë‹¤.

ë‘ ë²ˆì§¸ ë¬¸ì¥ì…ë‹ˆë‹¤.

ì„¸ ë²ˆì§¸ ë¬¸ì¥ì…ë‹ˆë‹¤.

---
âœ… **ë³€í™˜ ì™„ë£Œ** (ì†Œìš” ì‹œê°„: 05:30)
```

### 2.2 ì‹œê°„ëŒ€ë³„ íŒŒì¼ (_time.md)

```markdown
# â±ï¸ Audio Transcription - Time Intervals

> **íŒŒì¼**: `mp3/audio.mp3`  
> **ìƒíƒœ**: ë³€í™˜ ì™„ë£Œ

---

| ì‹œê°„ | ë‚´ìš© |
|---|---|
| 00:00 | ì²« ë²ˆì§¸ ì„¸ê·¸ë¨¼íŠ¸ í…ìŠ¤íŠ¸ |
| 00:15 | ë‘ ë²ˆì§¸ ì„¸ê·¸ë¨¼íŠ¸ í…ìŠ¤íŠ¸ |
| 00:30 | ì„¸ ë²ˆì§¸ ì„¸ê·¸ë¨¼íŠ¸ í…ìŠ¤íŠ¸ |

---
âœ… **ë³€í™˜ ì™„ë£Œ** (ì†Œìš” ì‹œê°„: 05:30)
```

### 2.3 ë¡œê·¸ íŒŒì¼ (log/YYYY-MM-DD.md)

```markdown
# ğŸ“‹ Transcription Log - 2026-01-21

---

## ğŸµ audio.mp3

| í•­ëª© | ê°’ |
|---|---|
| **íŒŒì¼** | `mp3/audio.mp3` |
| **ì˜¤ë””ì˜¤ ê¸¸ì´** | 59:30 |
| **ì‹œì‘ ì‹œê°„** | 2026-01-21 22:30:00 |
| **VAD** | ë¹„í™œì„±í™” |
| **ì–¸ì–´** | ko (99.8%) |
| **ì†Œìš” ì‹œê°„** | 05:30 |

---

## ğŸµ another.mp3

| í•­ëª© | ê°’ |
|---|---|
| **íŒŒì¼** | `mp3/another.mp3` |
| **ì˜¤ë””ì˜¤ ê¸¸ì´** | 45:00 |
| **ì‹œì‘ ì‹œê°„** | 2026-01-21 23:00:00 |
| **VAD** | í™œì„±í™” |
| **ì–¸ì–´** | ko (98.5%) |
| **ì†Œìš” ì‹œê°„** | 03:15 |
```

---

## 3. ë°ì´í„° ìŠ¤í‚¤ë§ˆ

### 3.1 ì„¸ê·¸ë¨¼íŠ¸ ë°ì´í„° (ë‚´ë¶€ ì²˜ë¦¬ìš©)

```python
segment = {
    "start": float,      # ì‹œì‘ ì‹œê°„ (ì´ˆ)
    "end": float,        # ì¢…ë£Œ ì‹œê°„ (ì´ˆ)
    "text": str          # ë³€í™˜ëœ í…ìŠ¤íŠ¸
}
```

### 3.2 ë³€í™˜ ê²°ê³¼ ë°ì´í„°

```python
result = {
    "text": str,                    # ì „ì²´ í…ìŠ¤íŠ¸
    "language": str,                # ê°ì§€ëœ ì–¸ì–´ ì½”ë“œ
    "language_probability": float,  # ì–¸ì–´ ê°ì§€ í™•ë¥ 
    "segments": list[segment]       # ì„¸ê·¸ë¨¼íŠ¸ ëª©ë¡
}
```

### 3.3 ë³€í™˜ ì •ë³´ (Info ê°ì²´)

```python
info = {
    "language": str,                # ê°ì§€ëœ ì–¸ì–´
    "language_probability": float,  # ì–¸ì–´ í™•ë¥ 
    "duration": float,              # ì˜¤ë””ì˜¤ ê¸¸ì´
    "all_language_probs": dict      # ëª¨ë“  ì–¸ì–´ í™•ë¥ 
}
```

---

## 4. íŒŒì¼ ëª…ëª… ê·œì¹™

### 4.1 ì¶œë ¥ íŒŒì¼
| ì…ë ¥ íŒŒì¼ | ì „ì²´ í…ìŠ¤íŠ¸ | ì‹œê°„ëŒ€ë³„ |
|-----------|-------------|----------|
| `audio.mp3` | `audio_full.md` | `audio_time.md` |
| `2024.01.01.mp3` | `2024.01.01_full.md` | `2024.01.01_time.md` |

### 4.2 ë¡œê·¸ íŒŒì¼
- í˜•ì‹: `log/YYYY-MM-DD.md`
- ì˜ˆì‹œ: `log/2026-01-21.md`
- ë™ì¼ ë‚ ì§œì— ì—¬ëŸ¬ ë³€í™˜ ì‹œ í•˜ë‚˜ì˜ íŒŒì¼ì— append

---

## 5. ë°ì´í„° ë¬´ê²°ì„±

### 5.1 ì‹¤ì‹œê°„ ì €ì¥
- ê° ì„¸ê·¸ë¨¼íŠ¸ ì™„ë£Œ ì‹œ ì¦‰ì‹œ íŒŒì¼ì— ê¸°ë¡ (append)
- ì¤‘ë‹¨ ì‹œì—ë„ ë°ì´í„° ì†ì‹¤ ì—†ìŒ

### 5.2 íŒŒì¼ ì ê¸ˆ
- ë™ì¼ íŒŒì¼ ë™ì‹œ ë³€í™˜ ì‹œ ë®ì–´ì“°ê¸° ë°œìƒ ê°€ëŠ¥
- í˜„ì¬ëŠ” ë‹¨ì¼ í”„ë¡œì„¸ìŠ¤ ê°€ì •

### 5.3 ì¸ì½”ë”©
- ëª¨ë“  íŒŒì¼: UTF-8
- ì¤„ë°”ê¿ˆ: LF (Unix style)

---

## 6. í–¥í›„ í™•ì¥ ê³ ë ¤

### 6.1 SQLite ë„ì… ì‹œ
```sql
CREATE TABLE transcriptions (
    id INTEGER PRIMARY KEY,
    audio_path TEXT NOT NULL,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    duration_seconds REAL,
    language TEXT,
    language_probability REAL,
    processing_time_seconds REAL,
    vad_enabled BOOLEAN,
    bgm_mode BOOLEAN,
    model_size TEXT
);

CREATE TABLE segments (
    id INTEGER PRIMARY KEY,
    transcription_id INTEGER REFERENCES transcriptions(id),
    start_time REAL,
    end_time REAL,
    text TEXT
);
```

### 6.2 JSON ìºì‹œ (ê²€í†  ì¤‘)
```json
{
  "audio_path": "mp3/audio.mp3",
  "hash": "sha256:...",
  "transcription": { ... },
  "cached_at": "2026-01-21T22:30:00"
}
```

---

*ë¬¸ì„œ ë²„ì „: 1.1*
*ìµœì¢… ìˆ˜ì •: 2026-01-21*
